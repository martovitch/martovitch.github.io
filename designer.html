<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Дорогой дизайнер</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Общие стили для body */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000; /* Черный фон */
            display: flex;
            flex-direction: column; /* Элементы будут располагаться по вертикали */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            box-sizing: border-box;
            position: relative; /* Для позиционирования уведомления и эффекта */
            transition: background-color 0.1s ease-out; /* Плавный переход для фона */
            overflow: hidden; /* Скрыть любой скролл */
        }

        /* --- Стили для кнопки-клавиши --- */
        .click-button {
            background-color: #ffffff; /* Белый цвет */
            color: #000000; /* Черный цвет текста */
            font-weight: bold;
            display: flex; /* Используем flexbox для центрирования содержимого */
            justify-content: center;
            align-items: center;
            width: 200px; /* Фиксированная ширина */
            height: 200px; /* Фиксированная высота */
            border-radius: 12px; /* Закругленные углы для клавиши */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2), 0 6px 20px rgba(0, 0, 0, 0.19); /* Тень для объема */
            font-size: 2.25rem; /* Большой размер шрифта */
            line-height: 2.5rem;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out, box-shadow 0.2s ease-in-out; 
            margin: 0 auto; /* Центрируем кнопку */
            flex-shrink: 0; /* Предотвращаем сжатие кнопки */
            z-index: 10; /* Убедимся, что кнопка поверх эффекта */
            position: relative; /* Для z-index */
            border: 1px solid rgba(0, 0, 0, 0.1); /* Легкая граница */
        }
        .click-button:hover {
            background-color: #f0f0f0; /* Чуть темнее белый при наведении */
        }
        .click-button:active {
            transform: scale(0.95); /* Небольшое уменьшение при нажатии */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 3px 10px rgba(0, 0, 0, 0.15); /* Меньшая тень при нажатии */
        }

        /* Стили для уведомления (Android-style toast) */
        .notification-toast {
            position: fixed; /* Фиксированное положение на экране */
            top: 20px; /* Отступ от верхнего края */
            left: 50%; /* Центрируем по горизонтали */
            transform: translateX(-50%); /* Точное центрирование */
            width: 100%; /* Занимает всю ширину, учитывая padding */
            max-width: 480px; /* Ограничиваем максимальную ширину как у высказываний */
            box-sizing: border-box; /* Включаем padding в ширину */
            padding: 0 20px; /* Отступы от левого и правого края экрана */
            opacity: 0; /* Изначально скрыто */
            visibility: hidden; /* Скрыто для доступности */
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            z-index: 1000; /* Поверх других элементов */
        }

        .notification-toast.show {
            opacity: 1;
            visibility: visible;
        }

        /* Стили для содержимого уведомления */
        .notification-content {
            background-color: rgba(0, 0, 0, 0.7); /* Полупрозрачный черный фон */
            color: white;
            padding: 12px 20px; /* Внутренние отступы для текста */
            border-radius: 20px; /* Закругление 20px */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size: 1rem; /* Размер шрифта уведомления */
            text-align: left; /* Текст выравнивается по левому краю */
            white-space: normal; /* Разрешаем перенос текста */
            width: 100%; /* Занимает всю ширину родителя */
            box-sizing: border-box; /* Включаем padding в ширину */

            display: flex; /* Используем flexbox для аватара и текста */
            align-items: flex-start; /* Выравнивание элементов по верху */
            gap: 12px; /* Расстояние между аватаром и текстом */
        }

        .notification-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%; /* Круглая форма */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: white; /* Цвет текста аватара */
            flex-shrink: 0; /* Не сжимать аватар */
        }

        .avatar-mom { background-color: #2196F3; } /* Blue 500 */
        .avatar-gennady-neighbor { background-color: #4CAF50; } /* Green 500 (for Gennady Sosed) */
        .avatar-customer { background-color: #FF9800; } /* Orange 500 */
        .avatar-wife { background-color: #E91E63; } /* Pink 500 */
        .avatar-earnings { background-color: #673AB7; } /* Deep Purple 500 */
        .avatar-fns { background-color: #9C27B0; } /* Purple 500 (for FNS) */


        .notification-text-content {
            display: flex;
            flex-direction: column;
            flex-grow: 1; /* Разрешает тексту занимать доступное пространство */
        }

        .notification-sender {
            font-weight: bold;
            font-size: 0.9rem; /* Чуть меньше основного текста */
            color: rgba(255, 255, 255, 0.8); /* Светлее, чем основной текст */
            margin-bottom: 2px;
        }

        .notification-message {
            font-size: 1rem;
            line-height: 1.4;
            color: white;
        }


        /* Стили для эффекта белого градиента при интенсивном клике */
        .fire-effect {
            position: fixed; /* Фиксированное положение на экране */
            top: 0;
            left: 0;
            width: 100vw; /* Занимает всю ширину окна просмотра */
            height: 100vh; /* Занимает всю высоту окна просмотра */
            background-color: rgba(255, 0, 0, 0); /* Красный, изначально полностью прозрачный */
            opacity: 0; /* Изначально скрыто */
            transition: background-color 0.1s ease-out, opacity 0.1s ease-out; /* Плавные переходы для opacity */
            pointer-events: none; /* Не блокирует клики по кнопке */
            z-index: 5; /* Позиционируем между фоном и кнопкой/счетчиком */
        }

        /* --- Стили для визуального отображения бонуса --- */
        .bonus-visual {
            position: absolute;
            padding: 10px 15px;
            background-color: #ffd700; /* Золотой цвет для бонуса */
            color: #4a5568;
            font-weight: bold;
            font-size: 1.2rem;
            white-space: nowrap;
            opacity: 1;
            animation: bonusFade 5s forwards; /* Анимация, длительность 5 секунд */
            z-index: 1005; /* Выше всего */
            pointer-events: none; /* Пропускает клики */
            display: flex; /* Для центрирования текста */
            justify-content: center;
            align-items: center;
            clip-path: none; 
            border-radius: 9999px; /* Делаем его овальным, как уведомление */
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.8); /* Эффект свечения */
            min-width: 100px; /* Минимальная ширина */
            min-height: 50px; /* Минимальная высота */
        }

        /* Анимация для бонуса: масштабирование, движение вверх и исчезновение */
        @keyframes bonusFade {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) rotate(var(--random-rotation, 0deg));
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -100%) scale(1.2) rotate(var(--random-rotation, 0deg)); /* Движение вверх и небольшое увеличение */
            }
        }

        /* --- Стили для архива уведомлений --- */
        .notification-archive {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9); /* Темный полупрозрачный фон */
            z-index: 2000; /* Поверх всего */
            display: flex;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            padding: 20px;
            box-sizing: border-box;
        }

        .notification-archive.show {
            opacity: 1;
            visibility: visible;
        }

        .archive-header {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        .archive-content-scroll {
            flex-grow: 1; /* Занимает все доступное пространство */
            overflow-y: auto; /* Включает прокрутку */
            -webkit-overflow-scrolling: touch; /* Плавная прокрутка на iOS */
            padding-right: 10px; /* Отступ для скроллбара */
        }

        .archive-notification-item {
            background-color: rgba(255, 255, 255, 0.1); /* Слегка прозрачный фон для каждого уведомления */
            margin-bottom: 12px;
            padding: 12px 20px;
            border-radius: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            color: white; /* Цвет текста */
        }
    </style>
</head>
<body>
    <!-- Canvas для фигур -->
    <canvas id="shapesCanvas" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1090; pointer-events: none;"></canvas>

    <!-- Счет кликов теперь внутри кнопки -->
    <button id="clickButton" class="click-button">
        <span id="score" class="font-extrabold">0 ₽</span>
    </button>

    <!-- Элемент для эффекта белого градиента при интенсивном клике -->
    <div id="fireEffect" class="fire-effect"></div>

    <!-- Элемент для уведомлений (тост) -->
    <div id="notificationToast" class="notification-toast">
        <div class="notification-content">
            <!-- Здесь будут динамически добавляться аватар и текст -->
        </div>
    </div>

    <!-- Архив уведомлений -->
    <div id="notificationArchive" class="notification-archive">
        <h3 class="archive-header">Все уведомления</h3>
        <div id="archiveContentScroll" class="archive-content-scroll">
            <!-- Здесь будут динамически добавляться старые уведомления -->
        </div>
        <!-- Кнопка закрытия удалена -->
    </div>

    <script>
        // Получаем элементы DOM
        const scoreDisplay = document.getElementById('score');
        const clickButton = document.getElementById('clickButton');
        const notificationToast = document.getElementById('notificationToast');
        const fireEffect = document.getElementById('fireEffect');
        const notificationArchive = document.getElementById('notificationArchive');
        const archiveContentScroll = document.getElementById('archiveContentScroll');
        // const archiveCloseButton = document.getElementById('archiveCloseButton'); // Удалена ссылка на кнопку

        // Canvas для фигур
        const shapesCanvas = document.getElementById('shapesCanvas');
        const shapesCtx = shapesCanvas.getContext('2d');

        // Инициализируем счет
        let score = 0;

        // Переменные для отслеживания интенсивности кликов и эффекта
        let clickIntensity = 0;
        const INTENSITY_INCREASE_PER_CLICK = 0.1;
        const INTENSITY_DECAY_RATE = 0.005;
        const MAX_INTENSITY = 1;

        // Пороги для наград и соответствующие сообщения
        const rewards = [
            { threshold: 10, message: 'Первый заказ на 10 ₽! Отличное начало портфолио.' },
            { threshold: 50, message: '50 ₽! Ваш дизайн продается! Клиенты ценят вашу работу.' },
            { threshold: 100, message: '100 ₽! Вы закрыли первый крупный проект. Так держать!' },
            { threshold: 200, message: '200 ₽! Заработок растет! Время подумать о новых инструментах.' },
            { threshold: 500, message: '500 ₽! Вы - полноценный фрилансер. Дизайн - это ваша стихия!' },
            { threshold: 1000, message: '1 000 ₽! Отличный доход за креативность. Подумайте о расширении.' },
            { threshold: 2000, message: '2 000 ₽! Заказчики в восторге! Ваши навыки — ваша прибыль.' },
            { threshold: 5000, message: '5 000 ₽! Поздравляем, вы стали востребованным дизайнером!' },
            { threshold: 10000, message: '10 000 ₽! Ваш бренд узнают. Заказы сыпятся один за другим.' },
            { threshold: 25000, message: '25 000 ₽! Вы управляете своей дизайн-империей!' },
            { threshold: 50000, message: '50 000 ₽! Вы настоящий гуру дизайна и бизнеса!' }
        ];

        const achievedRewards = new Set();
        let notificationToastTimeoutId = null; 

        const BONUS_CHANCE = 0.03;
        const BASE_BONUS_CLICKS = 10;
        const MAX_ADDITIONAL_BONUS_CLICKS = 50;
        
        const EXP_BASE_FOR_SCORE_BONUS = 1.002;
        const EXP_POWER_DIVISOR_FOR_SCORE_BONUS = 50;

        // --- Новые типы уведомлений и их пулы ---
        const allMomMessages = [
            "Привет! Как дела? Ты мне не перевел еще за коммунальные?",
            "Сынок, на хлеб не хватает. Поторопись со своими проектами!",
            "Срочно нужны деньги на лекарства. Твоя бабушка чихнула!",
            "Отправь хоть немного, пожалуйста. Очень надо! ❤️",
            "Ты обещал помочь с ремонтом, а денег все нет...",
            "Привет! Купила новые занавески, но за них еще не рассчиталась.",
            "Не забудь, я тебе занимала на твой первый графический планшет!",
            "Скоро день рождения у тети Вали, надо бы подарок купить.",
            "Хочу сходить в театр, а билеты дорогие. Поможешь?",
            "У меня лапка болит... Шучу, но деньги нужны на ветеринара для Мурзика.",
            "Ты мне за интернет заплатил? А то обрубят.",
            "Соседи купили новую машину, а у меня даже на такси нет!",
            "Пришли, сколько можешь. Хоть на молоко и кефир.",
            "Погода плохая, хочется теплых носков. На дизайнерские, надеюсь, хватит?",
            "Приезжай в гости, я блинов напекла. И прихвати конвертик...",
            "Сегодня скидки в магазине, а у меня кошелек пустой.",
            "Дорогой, тебе звонил Геннадий Сосед. Сказал, что скоро отдаст!",
            "У меня тут такая дизайнерская идея... Только денег на реализацию нет!",
            "Сын, у тебя там не завалялось лишних 500 рублей?",
            "Привет от бабушки! Она очень скучает и спрашивает, когда ты пришлешь.",
            "Не забудь, за свет платить надо, а то отключили в прошлый раз!",
            "Я тут задумалась... Может, купишь мне новый телефон? Мой совсем старенький.",
            "Внуки просят игрушки, а у меня на них нет. Поможешь?",
            "На даче трубу прорвало, нужен сантехник. Денег нет.",
            "Ты же дизайнер! Сделай мне логотип на сумку, и заодно денюжку подкинь.",
            "Соседка говорит, что ты миллионы зарабатываешь, а мне все копейки шлешь.",
            "Заходила в банк, там сказали, что у меня кредита много. Можешь погасить?",
            "Пришли деньги, а то холодильник пустой. Одни котлеты из прошлой жизни.",
            "Сегодня акция в 'Пятерочке', но надо ехать, а бензин дорогой.",
            "Сынок, не могу найти свой паспорт. Наверное, потеряла. А на новый нет денег."
        ];
        let momMessages = [...allMomMessages]; // Рабочий пул сообщений мамы

        const allStefanMessages = [ 
            "Бро, привет! Долг помню, но сейчас никак. Заказчик пропал.",
            "Извини, чувак, с деньгами напряг. Отдам, как только заплатят за проект.",
            "Привет! Срочно нужно было купить новый монитор, чтобы твой логотип доделать. В счет долга, ок?",
            "Братан, я бы отдал, но тут такие непредвиденные расходы на шрифты...",
            "Слышал про крипту? Сейчас не время выводить деньги, браток.",
            "Привет! Запустил стартап, все деньги туда ушли. Но твой долг в приоритете!",
            "Чувак, у меня сейчас такой завал с правками, что даже поесть некогда. Как разберусь, сразу отдам.",
            "Бро, как только продам свою новую NFT-коллекцию, сразу тебе. Жди!",
            "Извини, я в отпуске на Бали. Тут плохой интернет для переводов.",
            "Кстати, твой дизайн так круто смотрится! Он окупится, верь мне!",
            "Мой бухгалтер сказал, что пока не время для крупных переводов. Налоговая!",
            "Забыл пароль от онлайн-банка. Как восстановлю, сразу отдам.",
            "Я думал, что отдал тебе уже. Точно не было?",
            "Сегодня такая пробка была, все нервы вымотала, не до переводов сейчас.",
            "Мне самому скоро занимать придется, так что потерпи немного.",
            "Я как раз собирался тебе написать! Ты угадал, не могу пока отдать.",
            "А может, ты мне еще займешь? Я тебе потом все сразу отдам, обещаю!",
            "У меня новая идея для проекта, которая принесет миллионы! Можешь подождать?",
            "Извини, я сейчас медитирую. Деньги - это иллюзия.",
            "У меня просто форс-мажор! Не спрашивай, просто поверь.",
            "Привет! У меня сейчас временные финансовые трудности. Вроде, до конца месяца решу.",
            "Долг верну, как только продам свой старый холодильник. Обещаю!",
            "Извини, братан, деньги ушли на очень важный бизнес-тренинг. Это инвестиция!",
            "Моя кошка заболела, все деньги ушли на ветеринара. Пойми.",
            "Я сейчас на курсах по личностному росту. Денег нет, но я стал гораздо лучше!",
            "Мне нужна новая видеокарта для рендеринга. Долг подождет, да?",
            "Я сейчас в поиске инвесторов. Как только, так сразу!",
            "Деньги где-то зависли в платежной системе. Это не я, это они!",
            "Забыл, на что я тебе должен. Напомни, пожалуйста. Может, уже отдавал?",
            "Я же предлагал тебе долю в своем проекте вместо долга! Ты не захотел."
        ];
        const allGennadySosedMessages = allStefanMessages.map(msg => msg.replace("Стефан", "Геннадий Сосед"));
        let gennadySosedMessages = [...allGennadySosedMessages]; // Рабочий пул сообщений Геннадия Соседа

        const allCustomerMessages = [ 
            "Привет! Это насчет вашего дизайна. Срочно нужна правка!",
            "Ваш проект выглядит отлично! Но есть пара мелких замечаний...",
            "Мы готовы согласовать макет! Жду подтверждения!",
            "Здравствуйте, это по новому заказу. Вы свободны на этой неделе?",
            "Ваш дизайн произвел фурор! Есть еще работа для вас.",
            "Нужно срочно изменить шрифт, клиент передумал в последний момент!",
            "Срочно! Это по макету баннера. Сделайте его в 3D, пожалуйста.",
            "У нас появилась идея добавить анимированных единорогов в логотип. Возможно?",
            "Клиент просит сделать логотип более 'живым', но без движения. Как это?",
            "Очень срочно! Нужно переделать всю презентацию к утру!",
            "Это по поводу наших карточек. Фон должен быть 'небесно-лазурным', но не синим.",
            "Мы тут подумали, может быть, добавим больше 'воздуха' в дизайн, но чтобы он был плотным?",
            "Ваш дизайн прекрасен, но мы решили пойти по другому пути. Пока что.",
            "А вы можете сделать, чтобы цвета были 'теплыми', но при этом 'холодными'?",
            "Срочно! У нас новый проект, но бюджет минимальный. Справитесь?",
            "Клиент хочет, чтобы логотип был 'более корпоративным', но 'менее официальным'.",
            "Наш директор хочет увидеть 'что-то уникальное, но уже проверенное'.",
            "Пришлите, пожалуйста, все варианты логотипа до обеда.",
            "Мне нужен дизайн 'вау!', но без кричащих элементов.",
            "Мы хотим, чтобы сайт был 'продающим', но не 'агрессивным'. Как это сделать?",
            "А можно, чтобы иконки были такими же, но другими?",
            "Мне нужен баннер, который 'цепляет взгляд', но не 'отвлекает'.",
            "Посмотрите, пожалуйста, на наш новый бриф. Жду ваших предложений.",
            "Срочно! Клиент хочет добавить мигающие звезды на фон. Что скажете?",
            "Ваш макет хороший, но он 'не дышит'. Надо что-то с этим сделать."
        ];
        let customerMessages = [...allCustomerMessages]; // Рабочий пул сообщений заказчика

        const allWifeMessages = [
            "Дорогой, еще одна кошка родилась! 😻 Нужно купить корм, срочно!",
            "У нас теперь пять котят! Ты не поверишь, они такие милые... и голодные.",
            "Срочно! Кошачьи лотки переполнены! 🙀 Надо бы новый пакет наполнителя.",
            "Купи, пожалуйста, корм для котят, они уже едят как взрослые!",
            "Любимый, у нас пополнение! Еще одна пушистая радость. И счет за корм.",
            "Помнишь, ты хотел много кошек? Теперь у нас их 6! 😄",
            "Наша Мурка опять отличилась! Ждем прибавления. И денег на корм.",
            "Только что увидела маленького котенка! Он так ждет еды...",
            "У нас дома теперь целый кошачий детский сад! Нужен корм XXL.",
            "Они такие крошечные и уже мурлычут! А еще очень хотят кушать.",
            "Котятки подросли, им нужна новая когтеточка. И, конечно, корм!",
            "Дорогой, у меня котенок на голове спит. А другой голодный смотрит.",
            "Кажется, наш дом превратился в кошачье королевство! Поможешь королеве?",
            "Они так быстро растут! А это значит, еще больше корма!",
            "Привет! Как там твой дизайн? У нас тут котята просят кушать.",
            "Ох, эти кошки! Не успеешь оглянуться, как их уже десять!",
            "Им нужны новые игрушки! И, да, корм. Много корма.",
            "Только не забудь про корм для котят! Они очень ждут!",
            "Наши пушистики тебя очень любят и передают, что ждут еду!",
            "У нас очередная кошачья вечеринка, а без корма никак!",
            "Кошка родила ночью, даже не предупредила! Нужно срочно пеленки и молоко.",
            "Купи, пожалуйста, лосося для Барсика. Он сегодня отказался от обычного корма.",
            "У нас дома теперь звучит как 'Мяу-Мяу-Денс'! Корм заканчивается.",
            "Подари мне, пожалуйста, еще одну кошку на годовщину. И корм к ней.",
            "Я видела новый лежак для кошек, он очень дорогой, но такой мягкий!",
            "Котята разгромили кухню! Нужно больше корма, чтобы они были счастливы и спокойны.",
            "Ты знаешь, как сильно я люблю наших котиков... А они любят кушать!",
            "У меня возникла проблема: котята не хотят есть обычный корм. Попробуй купить что-то изысканное.",
            "Представляешь, наш Мурзик начал говорить 'корм'! Шучу, но очень хочется.",
            "Привет! Как твой день? У нас все хорошо, но котики голодают. :("
        ];
        let wifeMessages = [...allWifeMessages]; // Рабочий пул сообщений жены

        const allFNSMessages = [
            "Уплатите пенсионный взнос. Срок до 15.08.",
            "Уплатите медицинское страхование. Задолженность 2000 ₽.",
            "Напоминаем о необходимости уплатить НДФЛ. Срок до 01.10.",
            "Штраф за превышение скорости (Камера №7). Сумма 500 ₽.",
            "Пеня за несвоевременную уплату налога. Начислено 150 ₽.",
            "Требование об уплате имущественного налога.",
            "Уведомление о транспортном налоге. Срок уплаты 01.12.",
            "Заплатите налог на землю. Общая сумма 1200 ₽.",
            "Подайте налоговую декларацию до 30.04.",
            "Уведомление о камеральной проверке вашей декларации.",
            "Запрос документов по вашей деятельности.",
            "Расчеты по страховым взносам за 3 квартал.",
            "Просроченная задолженность по УСН.",
            "Приглашаем на сверку расчетов.",
            "Требуется уточнение по вашей налоговой базе.",
            "Штраф за непредоставление отчетности. Сумма 1000 ₽.",
            "Начислен налог на доходы от сдачи имущества в аренду.",
            "Необходимо уплатить добровольные взносы.",
            "Проверьте свои налоговые обязательства в личном кабинете.",
            "Задолженность по налогу на прибыль. Требуется погашение.",
            "Пеня за просрочку по НДС. Срочно оплатите.",
            "Обнаружено расхождение в данных по вашим операциям.",
            "Напоминание: срок уплаты налогов истекает через 3 дня.",
            "Штраф за нарушение правил валютного контроля.",
            "Ваша заявка на налоговый вычет отклонена. Требуется доработка.",
            "Дополнительные начисления по результатам проверки.",
            "Сообщаем о задолженности по всем видам налогов.",
            "Приглашаем на семинар по изменениям в законодательстве. Вход платный.",
            "Уведомление о возможном принудительном взыскании.",
            "Срочно погасите долг по налогу на имущество организаций.",
            "Вы не представили уведомление об исчисленных суммах.",
            "Ошибка в вашей налоговой декларации за прошлый год.",
            "Исполнительный лист по взысканию задолженности.",
            "Ваше ИП подлежит проверке на предмет соблюдения законодательства.",
            "Требование о представлении пояснений по доходам.",
            "Штраф за несоблюдение кассовой дисциплины.",
            "Начислены проценты за пользование бюджетными средствами.",
            "Уведомление о сумме задолженности по единому налоговому счету.",
            "Заблокирован ваш банковский счет. Срочно свяжитесь с нами.",
            "Ваша деятельность вызывает подозрение. Явитесь в отдел контроля.",
            "Уплатите налог на профессиональный доход (самозанятые).",
            "Напоминаем о квартальных взносах.",
            "Задолженность по акцизам. Срочно погасите.",
            "Пришло время уплаты НДС за предыдущий период.",
            "Пеня за каждый день просрочки по штрафу.",
            "Требование об уплате недоимки по налогу на прибыль.",
            "Зафиксировано нарушение в использовании ККТ.",
            "Ожидаем от вас пояснений по крупной сделке.",
            "Налоговая служба ждет ваши данные о доходах физлиц.",
            "Срок уплаты налога на добавленную стоимость подходит к концу.",
            "Не забудьте об авансовых платежах по налогу на имущество.",
            "Штраф за отсутствие маркировки товаров.",
            "Выявлены признаки дробления бизнеса.",
            "Приостановление операций по вашим счетам.",
            "Напоминаем о погашении долга перед бюджетом.",
            "Уведомление о начале выездной налоговой проверки.",
            "Срочно предоставьте документы, подтверждающие ваши расходы.",
            "Начислены дополнительные налоги после проверки контрагентов.",
            "Вы не уплатили налог на доход от продажи автомобиля.",
            "Требуется внесение изменений в вашу налоговую декларацию.",
            "Получено сообщение о ваших незадекларированных доходах.",
            "Начислен штраф за использование незаконных схем оптимизации.",
            "Срочно подтвердите свои зарубежные операции.",
            "Уведомление о задолженности по патентной системе налогообложения.",
            "Проведена сверка ваших данных, обнаружены расхождения.",
            "Зафиксирована операция, требующая дополнительного налогообложения.",
            "Вы не подали сведения о трудоустройстве.",
            "Напоминаем о необходимости уплаты НДПИ.",
            "Штраф за несвоевременное предоставление сведений.",
            "Уведомление о принудительной ликвидации задолженности.",
            "Запрос дополнительной информации по вашей инвестиционной деятельности.",
            "Ваша прибыль не соответствует среднеотраслевым показателям.",
            "Не предоставлены документы по запросу. Штраф 5000 ₽.",
            "Уплатите налог на недвижимость. Срок до 01.12.",
            "Произошла ошибка в расчете вашего налогового вычета.",
            "Напоминаем о декларировании доходов от ценных бумаг.",
            "Ваша компания подпадает под критерии риска.",
            "Требование о погашении задолженности по единому сельскохозяйственному налогу.",
            "Зафиксировано отсутствие контрольно-кассовой техники.",
            "Уведомление о начисленной сумме торгового сбора.",
            "Проверьте актуальность ваших регистрационных данных.",
            "Мы заметили, что вы не пользуетесь личным кабинетом. Это обязательно.",
            "Ваша декларация за 2023 год не принята. Ошибки.",
            "Срочно предоставьте пояснения по доходам от криптовалют.",
            "Начислен штраф за неправомерное применение налоговых льгот.",
            "Уведомление о необходимости уплатить налог на прибыль за прошлый квартал.",
            "Задолженность по транспортному налогу. Ждем оплаты.",
            "Напоминание: срок подачи заявления на патент истек.",
            "Вы забыли указать доходы от самозанятости. Исправьте.",
            "Уведомление о назначении нового инспектора по вашему делу.",
            "Ваши налоговые вычеты будут пересчитаны.",
            "Штраф за несвоевременную регистрацию кассового аппарата.",
            "Начислены пени по недоимке за несколько лет.",
            "Мы ожидаем подтверждения вашего адреса проживания.",
            "Вы не предоставили документы по иностранным счетам.",
            "Ваша налоговая история нуждается в корректировке.",
            "Срочно погасите долг. Государству нужны деньги.",
            "Налоговая бдит. Не расслабляйтесь. Ждем оплаты.",
            "Ваши доходы не совпадают с нашими данными. Поясните.",
            "Напоминаем о ваших обязанностях налогоплательщика.",
            "Вы находитесь в списке должников. Последнее предупреждение.",
            "Проверьте свои платежи, есть расхождения.",
            "Вам назначен новый штраф. За что - узнаете позже.",
            "Уплата налогов - ваш гражданский долг.",
            "Не забудьте заплатить за машину, а то заберут.",
            "Приготовьте документы, мы идем к вам с проверкой.",
            "Срочно оплатите. Мы знаем, сколько вы заработали."
        ];
        let fnsMessages = [...allFNSMessages];

        const fnsSuccessMessages = [
            "Успешная оплата. Спасибо, что остаетесь с нами, всего хорошего!",
            "Платеж принят. Ваш долг перед бюджетом погашен. Отличная работа!",
            "Оплата прошла успешно. Ваши налоговые обязательства выполнены. Благодарим!",
            "Спасибо за своевременную уплату. Вы законопослушный налогоплательщик. Всех благ!",
            "Ваша оплата получена. Налоговых претензий нет. Приятного дня!"
        ];
        let currentFNSSuccessMessages = [...fnsSuccessMessages]; // Рабочий пул сообщений об успешной оплате ФНС

        // Шанс появления "других" уведомлений
        const OTHER_NOTIFICATION_CHANCE = 0.05; 

        // Функция для перемешивания массива (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Рабочие пулы для сообщений, которые будут перемешиваться и опустошаться
        let currentMomMessages = [];
        let currentGennadySosedMessages = []; 
        let currentCustomerMessages = []; 
        let currentWifeMessages = [];
        let currentFNSMessages = [];


        // Инициализация пулов сообщений
        function initMessagePools() {
            currentMomMessages = [...allMomMessages];
            shuffleArray(currentMomMessages);

            currentGennadySosedMessages = [...allGennadySosedMessages]; 
            shuffleArray(currentGennadySosedMessages);

            currentCustomerMessages = [...allCustomerMessages]; 
            shuffleArray(currentCustomerMessages);

            currentWifeMessages = [...allWifeMessages];
            shuffleArray(currentWifeMessages);

            currentFNSMessages = [...allFNSMessages];
            shuffleArray(currentFNSMessages);
            
            currentFNSSuccessMessages = [...fnsSuccessMessages]; // Сброс пула успешных сообщений ФНС
            shuffleArray(currentFNSSuccessMessages);
        }

        // Цвета аватаров Material Design
        const avatarColors = {
            'Мама': '#2196F3', // Blue 500
            'Геннадий Сосед': '#4CAF50', // Green 500 (for Gennady Sosed)
            'Заказчик': '#FF9800', // Orange 500
            'Жена': '#E91E63', // Pink 500
            'Доход': '#673AB7', // Deep Purple 500 (для уведомлений о заработке)
            'ФНС': '#9C27B0' // Purple 500 (for FNS)
        };

        // --- Управление архивом уведомлений ---
        const allReceivedNotifications = []; // Массив для хранения всех полученных уведомлений

        function showNotificationArchive() {
            archiveContentScroll.innerHTML = ''; // Очищаем архив перед заполнением
            if (allReceivedNotifications.length === 0) {
                archiveContentScroll.innerHTML = '<p style="color: rgba(255,255,255,0.7); text-align: center; padding: 20px;">Пока здесь пусто. Получите несколько уведомлений!</p>';
            } else {
                // Добавляем уведомления в обратном порядке (от новых к старым)
                for (let i = allReceivedNotifications.length - 1; i >= 0; i--) {
                    const notif = allReceivedNotifications[i];
                    const archiveItem = document.createElement('div');
                    archiveItem.classList.add('archive-notification-item');

                    const avatar = document.createElement('div');
                    avatar.classList.add('notification-avatar');
                    avatar.style.backgroundColor = avatarColors[notif.sender] || '#757575';
                    avatar.textContent = (notif.sender === 'Геннадий Сосед') ? 'Г' : notif.sender.charAt(0).toUpperCase();
                    if (notif.sender === 'ФНС') avatar.textContent = 'Ф'; // Special handling for FNS

                    const textContent = document.createElement('div');
                    textContent.classList.add('notification-text-content');

                    const senderSpan = document.createElement('div');
                    senderSpan.classList.add('notification-sender');
                    senderSpan.textContent = notif.sender;

                    const messageSpan = document.createElement('div');
                    messageSpan.classList.add('notification-message');
                    messageSpan.textContent = notif.message;

                    textContent.appendChild(senderSpan);
                    textContent.appendChild(messageSpan);
                    archiveItem.appendChild(avatar);
                    archiveItem.appendChild(textContent);

                    archiveContentScroll.appendChild(archiveItem);
                }
            }
            notificationArchive.classList.add('show');
        }

        function hideNotificationArchive() {
            notificationArchive.classList.remove('show');
        }

        // archiveCloseButton.addEventListener('click', hideNotificationArchive); // Удалена подписка на событие


        // --- Логика свайпа ---
        let startY = 0;
        let dist = 0;
        const swipeOpenThreshold = window.innerHeight * 0.15; // 15% от высоты экрана для свайпа открытия
        const swipeCloseThreshold = window.innerHeight * 0.15; // 15% от высоты экрана для свайпа закрытия
        const swipeCloseAreaStart = window.innerHeight * 0.80; // 20% от низа экрана для активации закрытия

        document.body.addEventListener('touchstart', function(e) {
            startY = e.touches[0].clientY;
        });

        document.body.addEventListener('touchmove', function(e) {
            dist = e.touches[0].clientY - startY;

            // Открыть архив: свайп вниз из верхней 30% экрана
            if (dist > swipeOpenThreshold && startY < (window.innerHeight * 0.3) && !notificationArchive.classList.contains('show')) {
                showNotificationArchive();
                // Сброс startY, чтобы избежать повторного срабатывания при том же жесте
                startY = e.touches[0].clientY; 
                dist = 0;
            } 
            // Закрыть архив: свайп вверх из нижней 20% экрана
            else if (dist < -swipeCloseThreshold && notificationArchive.classList.contains('show') && startY > swipeCloseAreaStart) {
                hideNotificationArchive();
                // Сброс startY, чтобы избежать повторного срабатывания при том же жесте
                startY = e.touches[0].clientY; 
                dist = 0;
            }
        });

        document.body.addEventListener('touchend', function(e) {
            // Сброс состояния, если свайп не доведен до конца или не соответствует условиям
            startY = 0;
            dist = 0;
        });


        // --- Основные функции игры ---
        function updateScoreDisplay() {
            scoreDisplay.textContent = `${score} ₽`;
        }

        /**
         * Отображает уведомление в Material Design стиле и добавляет в архив.
         * @param {string} senderName - Имя отправителя (например, "Мама", "Геннадий Сосед", "Заказчик", "Жена", "Доход", "ФНС").
         * @param {string} messageText - Текст сообщения.
         */
        function showNotification(senderName, messageText) {
            if (notificationToastTimeoutId) {
                clearTimeout(notificationToastTimeoutId);
            }

            // Находим или создаем notification-content внутри notificationToast
            let notificationContentEl = notificationToast.querySelector('.notification-content');
            if (!notificationContentEl) {
                notificationContentEl = document.createElement('div');
                notificationContentEl.classList.add('notification-content');
                notificationToast.appendChild(notificationContentEl);
            }
            notificationContentEl.innerHTML = ''; // Очищаем содержимое

            // Добавляем уведомление в архив
            allReceivedNotifications.push({ sender: senderName, message: messageText });

            // Создаем элементы аватара
            const avatar = document.createElement('div');
            avatar.classList.add('notification-avatar');
            avatar.style.backgroundColor = avatarColors[senderName] || '#757575'; // Дефолтный серый, если цвет не найден
            avatar.textContent = (senderName === 'Геннадий Сосед') ? 'Г' : senderName.charAt(0).toUpperCase();
            if (senderName === 'ФНС') avatar.textContent = 'Ф'; // Special handling for FNS

            // Создаем контейнер для текста
            const textContent = document.createElement('div');
            textContent.classList.add('notification-text-content');

            // Создаем элемент для имени отправителя
            const senderSpan = document.createElement('div');
            senderSpan.classList.add('notification-sender');
            senderSpan.textContent = senderName;

            // Создаем элемент для текста сообщения
            const messageSpan = document.createElement('div');
            messageSpan.classList.add('notification-message');
            messageSpan.textContent = messageText;

            // Собираем структуру
            textContent.appendChild(senderSpan);
            textContent.appendChild(messageSpan);
            notificationContentEl.appendChild(avatar); 
            notificationContentEl.appendChild(textContent); 

            // Показываем уведомление
            notificationToast.classList.add('show');

            notificationToastTimeoutId = setTimeout(() => {
                notificationToast.classList.remove('show');
            }, 6000);
        }

        // Функция для показа других уведомлений с учетом неповторяемости
        function showOtherNotification() {
            // Не показываем другое уведомление, если уже есть активное уведомление о заработке
            if (notificationToast.classList.contains('show')) {
                return;
            }

            const availableTypes = [];

            if (currentMomMessages.length > 0) availableTypes.push({ sender: 'Мама', messages: currentMomMessages, original: allMomMessages, weight: 20 });
            if (currentGennadySosedMessages.length > 0) availableTypes.push({ sender: 'Геннадий Сосед', messages: currentGennadySosedMessages, original: allGennadySosedMessages, weight: 20 }); 
            if (currentCustomerMessages.length > 0) availableTypes.push({ sender: 'Заказчик', messages: currentCustomerMessages, original: allCustomerMessages, weight: 5 });
            if (currentWifeMessages.length > 0) availableTypes.push({ sender: 'Жена', messages: currentWifeMessages, original: allWifeMessages, weight: 20 });
            if (currentFNSMessages.length > 0) availableTypes.push({ sender: 'ФНС', messages: currentFNSMessages, original: allFNSMessages, weight: 10 }); // Добавляем ФНС

            // Если все пулы опустели, сбрасываем их
            if (availableTypes.length === 0) {
                initMessagePools();
                // После сброса, снова заполняем availableTypes
                if (currentMomMessages.length > 0) availableTypes.push({ sender: 'Мама', messages: currentMomMessages, original: allMomMessages, weight: 20 });
                if (currentGennadySosedMessages.length > 0) availableTypes.push({ sender: 'Геннадий Сосед', messages: currentGennadySosedMessages, original: allGennadySosedMessages, weight: 20 }); 
                if (currentCustomerMessages.length > 0) availableTypes.push({ sender: 'Заказчик', messages: currentCustomerMessages, original: allCustomerMessages, weight: 5 });
                if (currentWifeMessages.length > 0) availableTypes.push({ sender: 'Жена', messages: currentWifeMessages, original: allWifeMessages, weight: 20 });
                if (currentFNSMessages.length > 0) availableTypes.push({ sender: 'ФНС', messages: currentFNSMessages, original: allFNSMessages, weight: 10 });
            }

            const totalWeight = availableTypes.reduce((sum, type) => sum + type.weight, 0);

            if (totalWeight === 0) return; // Если после сброса все еще нет доступных сообщений (крайний случай)

            let randomWeight = Math.random() * totalWeight;
            let selectedType = null;

            for (const type of availableTypes) {
                randomWeight -= type.weight;
                if (randomWeight <= 0) {
                    selectedType = type;
                    break;
                }
            }

            if (selectedType) {
                const message = selectedType.messages.shift(); // Берем первое сообщение и удаляем его из пула
                
                if (selectedType.sender === 'ФНС') {
                    // Логика вычета денег для ФНС
                    if (score > 0) {
                        const deductionPercentage = Math.random() * (0.50 - 0.10) + 0.10; // От 10% до 50%
                        const deductionAmount = Math.round(score * deductionPercentage);
                        score = Math.max(0, score - deductionAmount); // Убедимся, что счет не станет отрицательным
                        updateScoreDisplay();
                        showNotification(selectedType.sender, `Снято ${deductionAmount} ₽. ${message}`); // Показываем сообщение о снятии
                        
                        // Случайное сообщение об успешной оплате от ФНС после снятия
                        if (currentFNSSuccessMessages.length === 0) {
                            currentFNSSuccessMessages = [...fnsSuccessMessages];
                            shuffleArray(currentFNSSuccessMessages);
                        }
                        const successMessage = currentFNSSuccessMessages.shift();
                        // Не показываем successMessage сразу, чтобы не перебивать основное
                        // Можно добавить небольшую задержку или просто положить в архив.
                        // Пока что просто добавим в архив, чтобы не усложнять UI с двумя тостами сразу.
                        allReceivedNotifications.push({ sender: 'ФНС', message: successMessage });
                        
                    } else {
                        // Если денег нет, просто показываем сообщение, но без снятия
                        showNotification(selectedType.sender, message);
                    }
                } else {
                    showNotification(selectedType.sender, message); // Для остальных отправителей просто показываем сообщение
                }
            }
        }

        function animateIntensity() {
            clickIntensity = Math.max(0, clickIntensity - INTENSITY_DECAY_RATE);

            // Красный прозрачный фон при интенсивном нажатии
            fireEffect.style.backgroundColor = `rgba(255, 0, 0, ${clickIntensity * 0.5})`; // Макс 50% прозрачности
            fireEffect.style.opacity = clickIntensity; // Дополнительный контроль видимости

            requestAnimationFrame(animateIntensity);
        }

        // --- Логика появления фигур ---
        let activeShapes = [];

        // Функция для изменения размера холста фигур
        function resizeShapesCanvas() {
            shapesCanvas.width = window.innerWidth;
            shapesCanvas.height = window.innerHeight;
        }

        // Класс для отдельных фигур
        class Shape {
            constructor(x, y, type, color, size) {
                this.x = x;
                this.y = y;
                this.type = type; // 'circle', 'square', 'triangle'
                this.color = color;
                this.size = size;
                this.alpha = 1;
                this.fadingRate = Math.random() * 0.01 + 0.005; 
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.05; 
                this.vx = (Math.random() - 0.5) * 4; 
                this.vy = (Math.random() - 0.5) * 4; 
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= this.fadingRate;
                this.rotation += this.rotationSpeed;
            }

            draw(ctx) {
                ctx.save();
                ctx.globalAlpha = Math.max(0, this.alpha);
                ctx.fillStyle = this.color;
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                if (this.type === 'circle') {
                    ctx.beginPath();
                    ctx.arc(0, 0, this.size / 2, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.type === 'square') {
                    ctx.fillRect(-this.size / 2, -this.size / 2, this.size, this.size);
                } else if (this.type === 'triangle') { 
                    ctx.beginPath();
                    ctx.moveTo(0, -this.size / 2);
                    ctx.lineTo(this.size / 2, this.size / 2);
                    ctx.lineTo(-this.size / 2, this.size / 2);
                    ctx.closePath();
                    ctx.fill();
                }
                ctx.restore();
            }
        }

        // Главный цикл анимации фигур
        function animateShapes() {
            shapesCtx.clearRect(0, 0, shapesCanvas.width, shapesCanvas.height); 

            activeShapes.forEach(shape => shape.update());
            activeShapes.forEach(shape => shape.draw(shapesCtx));

            activeShapes = activeShapes.filter(shape => shape.alpha > 0);

            requestAnimationFrame(animateShapes);
        }

        // Функция для запуска фигур (теперь черно-белых)
        function triggerShapes() {
            const shapeTypes = ['circle', 'square', 'triangle'];
            const colors = ['#000000', '#FFFFFF']; // Черный и белый цвета
            
            for (let i = 0; i < 15; i++) { 
                const randomX = Math.random() * shapesCanvas.width;
                const randomY = Math.random() * shapesCanvas.height;
                const randomType = shapeTypes[Math.floor(Math.random() * shapeTypes.length)];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                const randomSize = Math.random() * 20 + 10; 

                activeShapes.push(new Shape(randomX, randomY, randomType, randomColor, randomSize));
            }
        }

        // Обработчик клика по основной кнопке игры
        clickButton.addEventListener('click', () => {
            score++; 
            updateScoreDisplay();

            clickIntensity = Math.min(MAX_INTENSITY, clickIntensity + INTENSITY_INCREASE_PER_CLICK);

            if (Math.random() < BONUS_CHANCE) {
                const scoreBonus = Math.round(Math.pow(EXP_BASE_FOR_SCORE_BONUS, Math.max(1, score) / EXP_POWER_DIVISOR_FOR_SCORE_BONUS));
                const bonusClicks = BASE_BONUS_CLICKS + Math.round(clickIntensity * MAX_ADDITIONAL_BONUS_CLICKS) + scoreBonus;

                score += bonusClicks;
                updateScoreDisplay();

                const bonusVisual = document.createElement('div');
                bonusVisual.classList.add('bonus-visual');
                bonusVisual.textContent = `БОНУС +${bonusClicks} ₽`; 

                const randomRotation = Math.random() * 180 - 90;
                bonusVisual.style.setProperty('--random-rotation', `${randomRotation}deg`);

                const buttonRect = clickButton.getBoundingClientRect();
                const bodyRect = document.body.getBoundingClientRect(); 

                // Вычисление позиции относительно body для плавного появления из центра кнопки
                const posY = buttonRect.top + (buttonRect.height / 2) - (bonusVisual.offsetHeight / 2) - bodyRect.top;
                const posX = buttonRect.left + (buttonRect.width / 2) - bodyRect.left;

                bonusVisual.style.left = `${posX}px`;
                bonusVisual.style.top = `${posY}px`;
                
                document.body.appendChild(bonusVisual); // Добавляем в body

                setTimeout(() => {
                    bonusVisual.remove();
                }, 5000);
            }

            let earningsNotificationShown = false;
            rewards.forEach(reward => {
                if (score >= reward.threshold && !achievedRewards.has(reward.threshold)) {
                    showNotification('Доход', reward.message); // Теперь передаем имя отправителя 'Доход'
                    achievedRewards.add(reward.threshold);
                    triggerShapes(); // Запускаем фигуры при получении достижения
                    earningsNotificationShown = true;
                }
            });

            // Если не было показано уведомление о заработке, пробуем показать другое уведомление
            if (!earningsNotificationShown && Math.random() < OTHER_NOTIFICATION_CHANCE) {
                showOtherNotification();
            }
        });

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            resizeShapesCanvas(); // Устанавливаем начальный размер холста фигур
            updateScoreDisplay();
            animateIntensity();
            animateShapes(); // Запускаем анимацию фигур
            initMessagePools(); // Инициализируем пулы сообщений
        });

        // Слушаем изменение размера окна для корректного отображения фигур
        window.addEventListener('resize', resizeShapesCanvas);
    </script>
</body>
</html>
